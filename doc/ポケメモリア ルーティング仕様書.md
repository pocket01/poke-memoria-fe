# ポケメモリア ルーティング仕様書

## 概要

本書では、ポケメモリアのWebアプリケーションにおけるルーティング（URL設計）の仕様を定義する。Next.js App Routerを使用し、ウィザード形式で履歴書を作成する各ステップに固有のURLを持たせることで、ブラウザの「戻る」ボタンの直感的な動作と、ステップのリロード時の状態保持を実現する。

## ルーティング構成

### URL構成表

| パス | 役割 | 対応するStep | 説明 |
| --- | --- | --- | --- |
| `/create` | イントロダクション | 導入 | 履歴書作成の開始画面 |
| `/create/origin` | 初めての冒険を選択 | Step 1 | プレイした最初のポケモン作品を選択 |
| `/create/history` | プレイ作品・スタンプ選択 | Step 2 | プレイした作品の履歴とスタンプを選択 |
| `/create/partners` | 相棒の選択とコメント | Step 3 | 思い出のポケモンを選択しコメントを記入 |
| `/create/identity` | 属性・スタイル・自由記述 | Step 4 | トレーナー情報とタグを入力 |
| `/create/preview` | 最終確認と保存 | 生成・プレビュー | 作成した履歴書の最終確認と保存 |

### ディレクトリ構造

`app/create/` 配下の構成：

```text
app/create/
├── layout.tsx          # 共通レイアウト（ResumeProvider配置）
├── page.tsx            # 導入画面 (/create)
├── [step]/             # 動的ルーティングでステップを管理
│   └── page.tsx        # 各ステップのページ
├── origin/             # Step 1: 初めての冒険
│   └── page.tsx
├── history/            # Step 2: プレイ作品・スタンプ選択
│   └── page.tsx
├── partners/           # Step 3: 相棒の選択とコメント
│   └── page.tsx
├── identity/           # Step 4: 属性・スタイル・自由記述
│   └── page.tsx
└── preview/            # 最終確認と保存
    └── page.tsx
```

> **Note**: プロジェクト全体のディレクトリ構成については [README.md](../README.md#-ディレクトリ構成) を参照してください。

## 設計方針

### 1. 固有URLの採用理由

- **ブラウザの戻るボタン対応**: ユーザーが前のステップに戻る際、ブラウザの戻るボタンで直感的に操作できる
- **リロード時の状態保持**: 特定のステップをリロードしても、最初からやり直しにならない
- **URL共有**: 特定のステップへの直接アクセスが可能（開発・デバッグ時に有用）

### 2. 画面遷移の流れ

```text
/create
  ↓
/create/origin
  ↓
/create/history
  ↓
/create/partners
  ↓
/create/identity
  ↓
/create/preview
```

### 3. ナビゲーション実装

- `useRouter`フックを使用して次のURLへ遷移
- 「次へ」ボタンの共通化により、各ページの実装を簡素化
- 共通ナビゲーションコンポーネントの作成を推奨

## URLパラメータ設計

### 概要

ポケメモリアでは、作成した履歴書のデータをURLパラメータとして保持することで、サーバー不要で履歴書の共有を実現します。URLの長さ制限（約2,000文字）を考慮し、各パラメータは短縮形を使用しています。

### URLパラメータ一覧

| URLキー | Memories属性 | 型 | 内容・例 | 制限 |
| --- | --- | --- | --- | --- |
| `st` | `style` | `string` | ビジュアルスタイル (`paper`, `neo_gb`, `retro_rg`) | - |
| `tn` | `trainerName` | `string` | トレーナー名 | - |
| `sy` | `startedYear` | `string` | 冒険を始めた年 | 4桁の年 |
| `ot` | `originTitleId` | `string` | 原点の作品ID (`rg`, `gs`, `rs`等) | - |
| `hi` | `history` | `string` | プレイ歴。`ID.状態`をカンマ区切り (`rg.r,gs.l,rs.m`) | - |
| `p1i` ~ `p6i` | `partners[n].id` | `number` | 相棒ポケモンの図鑑番号 (`p1i=25`) | 1~6 |
| `p1c` ~ `p6c` | `partners[n].comment` | `string` | 相棒へのコメント | **最大20文字** |
| `tg` | `tags` | `string` | タグをカンマ区切り (`色違い勢,対戦ガチ勢`) | - |
| `ms` | `message` | `string` | 自由記述メッセージ | **最大200文字** |

### プレイステータスの短縮形

プレイ歴（`hi`）パラメータ内で使用される状態コード：

| コード | 意味 | 表示ラベル |
| --- | --- | --- |
| `r` | release | 発売当時に |
| `l` | later | 後からプレイ |
| `m` | remake | リメイクで |

### 作品IDの短縮形

URLパラメータで使用される作品IDの対応表：

| ID | 作品名 | 世代 |
| --- | --- | --- |
| `rg` | 赤・緑・青・ピカチュウ | 1 |
| `gs` | 金・銀・クリスタル | 2 |
| `rs` | ルビー・サファイア・エメラルド | 3 |
| `frlg` | ファイアレッド・リーフグリーン | 3 |
| `dp` | ダイヤモンド・パール・プラチナ | 4 |
| `hgss` | ハートゴールド・ソウルシルバー | 4 |
| `bw` | ブラック・ホワイト | 5 |
| `xy` | X・Y | 6 |
| `oras` | オメガルビー・アルファサファイア | 6 |
| `sm` | サン・ムーン | 7 |
| `ss` | ソード・シールド | 8 |
| `bdsp` | ブリリアントダイヤモンド・シャイニングパール | 8 |
| `la` | Pokémon LEGENDS アルセウス | 8 |
| `sv` | スカーレット・バイオレット | 9 |
| `lza` | Pokémon LEGENDS Z-A | 9 |

### URLパラメータの例

```
/create/preview?st=paper&tn=サトシ&sy=1997&ot=rg&hi=rg.r,gs.r,rs.l&p1i=25&p1c=相棒ピカチュウ&p2i=6&p2c=かっこいいリザードン&tg=色違い勢,対戦ガチ勢&ms=ポケモンと一緒に成長してきました！
```

### 設計方針

1. **URL短縮**: パラメータキーは2文字程度に短縮し、URL長を削減
2. **区切り文字**: 配列データはカンマ（`,`）で区切り
3. **エンコーディング**: 日本語文字列は`encodeURIComponent`で適切にエンコード
4. **文字数制限**: 
   - 相棒コメント: 最大20文字（短く熱いメッセージを推奨）
   - 自由記述: 最大200文字（ユーザーの「好き」を表現）
5. **URL長制限**: 総文字数が約2,000文字以内に収まるよう設計

### 各画面での利用

| 画面 | 使用するパラメータ |
| --- | --- |
| `/create/origin` | `ot`（原点作品ID） |
| `/create/history` | `hi`（プレイ歴）、`sy`（開始年） |
| `/create/partners` | `p1i~p6i`（ポケモンID）、`p1c~p6c`（コメント） |
| `/create/identity` | `tn`（トレーナー名）、`tg`（タグ）、`ms`（メッセージ）、`st`（スタイル） |
| `/create/preview` | 全パラメータ |

## 技術仕様

- **フレームワーク**: Next.js (App Router)
- **ルーティング方式**: ファイルシステムベースルーティング
- **遷移制御**: `next/navigation`の`useRouter`を使用
- **パラメータ管理**: URLSearchParamsを使用してパラメータを読み書き

## 備考

- 各ページのレイアウトは`create/layout.tsx`で共通化
- 状態管理は`ResumeProvider`を通じて各ページで利用可能（詳細は「状態管理仕様書」を参照）
- URLパラメータの定義は`src/types/types.ts`の`URL_PARAM_KEYS`に定義
- 作品マスターデータは`src/constants/constants.ts`の`POKEMON_TITLES`に定義
